<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Vehicle Control</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    .controls { display:flex; gap:10px; margin-bottom:20px; }
    .controls button { padding:12px 18px; font-size:16px; cursor:pointer; }
    .status-grid { display:grid; grid-template-columns: repeat(4, 1fr); gap:12px; }
    .status-box { border:1px solid #ccc; padding:16px; text-align:center; border-radius:6px; }
    .label { color:#666; font-size:14px; }
    .value { font-size:20px; font-weight:600; margin-top:6px; }
  </style>
</head>
<body>
  <h2>Vehicle Control Panel</h2>

  <div class="controls">
    <button id="fwdBtn">Forward</button>
    <button onclick="sendAction('back')">Back</button>
    <button onclick="sendAction('left')">Left</button>
    <button onclick="sendAction('right')">Right</button>
  </div>

  <div class="status-grid">
    <div class="status-box">
      <div class="label">Temperature (Â°C)</div>
      <div id="temperature" class="value">--</div>
    </div>
    <div class="status-box">
      <div class="label">Speed (m/s)</div>
      <div id="speed" class="value">--</div>
    </div>
    <div class="status-box">
      <div class="label">Angle (Â°)</div>
      <div id="angle" class="value">--</div>
    </div>
    <div class="status-box">
      <div class="label">Voltage (V)</div>
      <div id="voltage" class="value">--</div>
    </div>
  </div>
  
  <div class="status-box" style="margin-top:24px;">
    <h3>Input route</h3>

    <div style="display:flex; gap:10px; margin-bottom:10px;">
      <input id="afstandInput" type="number" placeholder="Distance" />
      <input id="hoekInput" type="number" placeholder="angle (Â°)" />
      <button onclick="addStep()">âž• Add</button>
    </div>

    <ul id="routeList"></ul>

    <button onclick="readRoute()">ðŸ“¤ Read route</button>
	<button onclick="sendRoute()">ðŸ“¤ Send route</button>
  </div>


<script>
async function sendAction(action) {
  try {
    const res = await fetch('/control', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({action})
    });
    if (!res.ok) {
      const err = await res.json().catch(()=>({}));
      console.error('Control error', err);
    } else {
      // optionally update status immediately after action
      updateStatus();
    }
  } catch (e) {
    console.error(e);
  }
}

async function updateStatus() {
  try {
    const res = await fetch('/status');
    if (!res.ok) return;
    const j = await res.json();
    document.getElementById('temperature').textContent = j.temperature;
    document.getElementById('speed').textContent = j.speed;
    document.getElementById('angle').textContent = j.angle;
    document.getElementById('voltage').textContent = j.voltage;
  } catch (e) { console.error(e); }
}

let route = [];

function addStep() {
  const distance = document.getElementById('afstandInput').value;
  const angle = document.getElementById('hoekInput').value;

  if (distance === '' || angle === '') return;

  route.push({ distance: Number(distance), angle: Number(angle) });

  const li = document.createElement('li');
  li.textContent = `Distance: ${distance}, Angle: ${angle}Â°`;
  document.getElementById('routeList').appendChild(li);

  document.getElementById('afstandInput').value = '';
  document.getElementById('hoekInput').value = '';
}

async function sendRoute() {
  try {
    const res = await fetch('/route', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ route })
    });

    if (res.ok) {
      alert('Route sent!');
      route = [];
      document.getElementById('routeList').innerHTML = '';
    }
  } catch (e) {
    console.error(e);
  }
}

async function readRoute() {
  try {
    const res = await fetch('/readroute', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ route })
    });

    if (res.ok) {
      alert('Route read!');
//      route = [];
//      document.getElementById('routeList').innerHTML = '';
    }
  } catch (e) {
    console.error(e);
  }
}

    let intervalId = null;

    function startRepeating() {
        if (intervalId === null) {
            intervalId = setInterval(() => {
                sendAction('forward');
            }, 300); // elke 300 ms
        }
    }

    function stopRepeating() {
        if (intervalId !== null) {
            clearInterval(intervalId);
            intervalId = null;
        }
    }

    const btn = document.getElementById("fwdBtn");

    // Desktop
    btn.addEventListener("mousedown", startRepeating);
    btn.addEventListener("mouseup", stopRepeating);
    btn.addEventListener("mouseleave", stopRepeating);

    // Mobile
    btn.addEventListener("touchstart", startRepeating);
    btn.addEventListener("touchend", stopRepeating);

// Poll status every second
setInterval(updateStatus, 1000);
updateStatus();

</script>
</body>
</html>
